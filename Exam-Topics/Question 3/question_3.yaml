# Run in bash

# Access to documentation
https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/

kubectl get nodes
kubectl cordon mk8s-master-0
kubectl drain mk8s-master-0 --ignore-daemonsets

ssh mk8s-master-0
sudo -i

kubeadm version
sudo apt-mark unhold kubeadm && \
sudo apt-get update && sudo apt-get install -y kubeadm='1.22.2-00' && \
sudo apt-mark hold kubeadm
kubeadm version
sudo kubeadm upgrade plan

sudo kubeadm upgrade apply v1.22.2

sudo apt-mark unhold kubelet kubectl && \
sudo apt-get update && sudo apt-get install -y kubelet='1.22.2-00' kubectl='1.22.2-00' && \
sudo apt-mark hold kubelet kubectl

sudo systemctl daemon-reload
sudo systemctl restart kubelet

kubelet --version
kubectl version
exit

kubectl uncordon mk8s-master-0
kubectl get nodes